<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>GPUs &#8211; Adventures in Machine Learning</title>
	<atom:link href="http://adventuresinmachinelearning.com/category/deep-learning/gpus/feed/" rel="self" type="application/rss+xml" />
	<link>http://adventuresinmachinelearning.com</link>
	<description>Learn and explore machine learning</description>
	<lastBuildDate>Sun, 09 Sep 2018 07:53:16 +0000</lastBuildDate>
	<language>en-AU</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.8</generator>
	<item>
		<title>How to create a TensorFlow deep learning powerhouse on Amazon AWS</title>
		<link>http://adventuresinmachinelearning.com/tensorflow-amazon-aws/</link>
		<comments>http://adventuresinmachinelearning.com/tensorflow-amazon-aws/#respond</comments>
		<pubDate>Sat, 18 Nov 2017 09:53:10 +0000</pubDate>
		<dc:creator><![CDATA[Andy]]></dc:creator>
				<category><![CDATA[Amazon AWS]]></category>
		<category><![CDATA[Deep learning]]></category>
		<category><![CDATA[GPUs]]></category>
		<category><![CDATA[Recurrent neural networks]]></category>
		<category><![CDATA[TensorFlow]]></category>

		<guid isPermaLink="false">http://adventuresinmachinelearning.com/?p=703</guid>
		<description><![CDATA[<p>In my previous tutorial on recurrent neural networks and LSTM networks in TensorFlow, we weren&#8217;t able to get fantastic results. This is because I was <a class="mh-excerpt-more" href="http://adventuresinmachinelearning.com/tensorflow-amazon-aws/" title="How to create a TensorFlow deep learning powerhouse on Amazon AWS">[...]</a></p>
<p>The post <a rel="nofollow" href="http://adventuresinmachinelearning.com/tensorflow-amazon-aws/">How to create a TensorFlow deep learning powerhouse on Amazon AWS</a> appeared first on <a rel="nofollow" href="http://adventuresinmachinelearning.com">Adventures in Machine Learning</a>.</p>
]]></description>
				<content:encoded><![CDATA[<p>In my previous tutorial on recurrent neural networks and LSTM networks in TensorFlow, we weren&#8217;t able to get fantastic results. This is because I was running the code on my little ol&#8217; laptop CPU &#8211; not exactly the ideal setup for big deep learning networks. So what to do? I could fork out thousands on a specced up desktop with <a href="https://www.nvidia.com/en-us/deep-learning-ai/developer/" target="_blank" rel="noopener">NVIDIA GPUs</a>, but, you know, I have a family and bills to pay. So the best option, I think, is to hire out some GPUs on Amazon AWS. That&#8217;s just what I did, and I&#8217;m going to give you a how-to guide below on how to do it. Then I&#8217;m going to run the <a href="https://github.com/adventuresinML/adventures-in-ml-code" target="_blank" rel="noopener">sequence-to-sequence LSTM model</a> that I created in TensorFlow, and show you the improvements. So let&#8217;s get to it.</p>
<hr />
<p><strong>Recommended online course: </strong>If you are more of a video course learner, checkout the following highly rated and inexpensive Udemy course, which covers deep learning concepts and how to deploy on Amazon AWS too: <a href="https://click.linksynergy.com/link?id=Jbc0N5ZkDzk&amp;offerid=323058.772462&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fdata-science-deep-learning-in-theano-tensorflow%2F" target="new">Modern Deep Learning in Python</a><img src="https://ad.linksynergy.com/fs-bin/show?id=Jbc0N5ZkDzk&amp;bids=323058.772462&amp;type=2&amp;subid=0" width="1" height="1" border="0" /></p>
<hr />
<h1>Step 1 &#8211; Setup an Amazon AWS account and load up an instance</h1>
<p>The first thing to do is to head over to <a href="https://aws.amazon.com/" target="_blank" rel="noopener">Amazon AWS</a> and create an account. You&#8217;ll need to supply some credit card details, as the computing power isn&#8217;t free &#8211; but we&#8217;ll be using a cheap option here, so it shouldn&#8217;t cost you too much if you want to follow along (a few dollars). At this stage, you may have to request, via Amazon AWS support, for them to free up an EC2 instance for you in your region. To do this, log into your Amazon AWS account and go to the dashboard. At the top of the window you&#8217;ll see a &#8220;Services&#8221; drop down &#8211; click this and select the Support link on the left hand side. Once you&#8217;ve clicked this, on the next page click &#8220;Create Case&#8221;, again on the left hand side menu.</p>
<p>On this page, next to the heading &#8220;Regarding&#8221;, select &#8220;Service Limit Increase&#8221;. Then, under &#8220;Limit Type&#8221; select &#8220;EC2 Instances&#8221;. Select your closest region, and under &#8220;Primary Instance Type&#8221; select &#8220;p2.xlarge&#8221;. Leave the &#8220;Limit&#8221; field as &#8220;Instance Limit&#8221;, and put a &#8220;1&#8221; in the field &#8220;New limit value&#8221;. Put in a use case description i.e. &#8220;Deep learning computing&#8221; then submit the case. Amazon AWS will then free up an instance for you to use, which might take a little while for them to do. If the terms above like &#8220;EC2 instance&#8221; and &#8220;p2.xlarge&#8221; don&#8217;t make sense at this stage, don&#8217;t worry &#8211; they are explained more fully later.</p>
<p>Once you&#8217;re done that, head over to <a href="https://aws.amazon.com/marketplace/pp/B01M0AXXQB?qid=1510042228622&amp;sr=0-3&amp;ref_=srh_res_product_title" target="_blank" rel="noopener">this link</a>. This page (see below) details a specifically setup Amazon Machine Instance (AMI) with all your favorite deep learning packages already loaded up &#8211; TensorFlow, Keras, PyTorch, CNTK, MXNet and more.</p>
<figure id="attachment_704" style="width: 1526px" class="wp-caption alignnone"><img class="size-full wp-image-704" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1.png" alt="Amazon AWS TensorFlow how-to: AMI selection" width="1526" height="798" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1.png 1526w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-300x157.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-768x402.png 768w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-1024x535.png 1024w" sizes="(max-width: 1526px) 100vw, 1526px" /><figcaption class="wp-caption-text">Amazon AWS &#8211; deep learning AMI selection</figcaption></figure>
<p>Scroll down and check out the EC2 instances available and the hourly prices on the right hand side. The EC2 instances are scale-able cloud computing services offered by Amazon AWS, and there are lots of different machine arrangements to choose from. In this case, we want to choose an AMI with at least 1 NVIDIA GPU. To do that, select your appropriate region on the right hand side and then hit the continue button.</p>
<p>You&#8217;ll then be taken to a launch page that looks like:</p>
<figure id="attachment_705" style="width: 1411px" class="wp-caption alignnone"><img class="size-full wp-image-705" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-instance-selection.png" alt="Amazon AWS TensorFlow - AMI instance selection" width="1411" height="805" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-instance-selection.png 1411w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-instance-selection-300x171.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-instance-selection-768x438.png 768w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-instance-selection-1024x584.png 1024w" sizes="(max-width: 1411px) 100vw, 1411px" /><figcaption class="wp-caption-text">AMI instance selection</figcaption></figure>
<p>Let&#8217;s go with the &#8220;1-Click Launch&#8221; option to make things nice and easy. Then, I&#8217;d suggest selecting the p2.xlarge EC2 instance under the &#8220;EC2 Instance Type&#8221; pane. This gives us 1 NVIDIA K80 GPU to play with. At the time of writing, this instance costs $1.54 / hour for an Asia Pacific (Sydney) deploy. Not too bad.</p>
<p>If you&#8217;re like me and haven&#8217;t done this before, scroll down to the bottom of the page and you&#8217;ll find this box:</p>
<figure id="attachment_706" style="width: 509px" class="wp-caption aligncenter"><img class=" wp-image-706" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-key-pair.png" alt="Amazon AWS TensorFlow - key pair creation" width="509" height="188" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-key-pair.png 850w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-key-pair-300x111.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-key-pair-768x284.png 768w" sizes="(max-width: 509px) 100vw, 509px" /><figcaption class="wp-caption-text">Key pair creation</figcaption></figure>
<p>Expand the Key Pair pane and follow the instructions &#8211; this Key Pair is a security measure that is required to perform the necessary secure encryption when you logon to your instance. Once you&#8217;ve done that, refresh the page again, and make sure that your region matches if you had to change it. Once you match the region correctly with your Key Pair, the &#8220;Launch with 1-click&#8221; button will become enabled, as shown below. Click this, and your instance will be created after a few minutes.</p>
<figure id="attachment_707" style="width: 327px" class="wp-caption aligncenter"><img class=" wp-image-707" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-launch-button-enabled.png" alt="Amazon AWS TensorFlow - launch button enabled" width="327" height="245" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-launch-button-enabled.png 586w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-launch-button-enabled-300x225.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-launch-button-enabled-326x245.png 326w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-launch-button-enabled-80x60.png 80w" sizes="(max-width: 327px) 100vw, 327px" /><figcaption class="wp-caption-text">Launch button enabled</figcaption></figure>
<p>Once you&#8217;ve hit the button above, you can go back to your <a href="http://console.aws.amazon.com/" target="_blank" rel="noopener">Amazon AWS dashboard</a>. Search or select the &#8220;EC2&#8221; service (under the &#8220;Compute&#8221; heading) in the AWS Services. This will take you to your EC2 dashboard, it should look something like this:</p>
<figure id="attachment_710" style="width: 670px" class="wp-caption aligncenter"><img class=" wp-image-710" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-EC2-console.png" alt="Amazon AWS TensorFlow - EC2 console" width="670" height="319" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-EC2-console.png 1469w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-EC2-console-300x143.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-EC2-console-768x366.png 768w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Step-1-EC2-console-1024x488.png 1024w" sizes="(max-width: 670px) 100vw, 670px" /><figcaption class="wp-caption-text">Amazon AWS EC2 console</figcaption></figure>
<p>Note that under the Resources heading, there should be &#8220;1 Running Instances&#8221; showing &#8211; this is your instance. To access your running AMI, on the left hand side select &#8220;Instances&#8221;. You&#8217;ll then see your p2.xlarge instance up and running on the main pane. Select the button &#8220;Connect&#8221;. You&#8217;ll be presented with a pop-up window &#8220;Connect To Your Instance&#8221; &#8211; select either option. I&#8217;m using &#8220;A standalone SSH client&#8221; (PuTTY on Windows) &#8211; but you can choose whichever method you like to connect. Just follow the instruction Amazon AWS gives you to setup.</p>
<p>If you&#8217;re using PuTTY, there is one final step to allow you to properly use a Linux text manager and terminal multiplexer called Byobu. In your PuTTY program, before you connect, go to the settings menu on the left hand side. Under Connections &#8211; Data, in the field &#8220;Terminal-type string&#8221; enter &#8220;putty-256color&#8221;. This allows you to hit Ctrl-F2 in Windows to create multiple screens in Linux, which will let us monitor our GPU performance while training &#8211; this will be discussed later.</p>
<p>Once you&#8217;ve done that &#8211; you&#8217;re all connected! You should see a command prompt that looks like:</p>
<figure id="attachment_712" style="width: 966px" class="wp-caption alignnone"><img class="size-full wp-image-712" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Remote-console.png" alt="Amazon AWS TensorFlow - remote Linux console" width="966" height="356" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Remote-console.png 966w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Remote-console-300x111.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Amazon-AWS-Remote-console-768x283.png 768w" sizes="(max-width: 966px) 100vw, 966px" /><figcaption class="wp-caption-text">AMI remote Linux console</figcaption></figure>
<h1>Step 2 &#8211; Exploring the instance and loading up the code</h1>
<p>The first thing you want to do when you have your instance running is update all the packages &#8211; you do this by running:</p>
<blockquote><p>sudo yum upgrade</p></blockquote>
<p>Next, let&#8217;s clone the Adventures in Machine Learning <a href="https://github.com/adventuresinML/adventures-in-ml-code" target="_blank" rel="noopener">github repo</a> by executing the following:</p>
<blockquote><p>git clone https://github.com/adventuresinML/adventures-in-ml-code</p></blockquote>
<p>Let&#8217;s also install a Python package called <em>gpustat </em>that we will use to monitor how our Nvidia GPU on the Amazon AWS instance is going as we train our recurrent neural network. Run:</p>
<blockquote><p>pip install gpustat</p></blockquote>
<p>Ok, so we&#8217;re not too far off being able to run the code using the GPU. However, first we&#8217;ll want to be able to monitor the GPU as we train. To do this on a Linux machine we need two screens, and we can use the package mentioned earlier called byobu to do this. To install it, we first need to go back to the root or administration privilege of our instance. Run this:</p>
<blockquote><p><span class="pln">sudo su </span><span class="pun">&#8211; </span></p></blockquote>
<p>Then to install byobu run this:</p>
<blockquote><p>yum install byobu</p></blockquote>
<p>Ok &#8211; now you can run byobu by simply typing &#8220;byobu&#8221; at the command prompt. To open up a new window, press Ctrl-F2. You&#8217;ll see this opens a new screen in your Linux session. To switch between the screens, press Ctrl-F3 and Ctrl-F4. Now, on one screen, we want to run the following to start a background monitoring process (which speeds up our gpustat package):</p>
<blockquote><p>sudo nvidia-smi daemon</p></blockquote>
<p>Then, on the same screen let&#8217;s setup our gpustat watch function, which will give us data about the GPU usage:</p>
<blockquote><p>watch -n1.0 gpustat -cp</p></blockquote>
<p>You should now see a utility printout with the GPU temperature, percentage usage and memory stats (see below for an example when we are actually running the code).</p>
<p>Now switch back to the other screen, using either Ctrl-F3 or Ctrl-F4.</p>
<h1>Step 3 &#8211; Download the data and run</h1>
<p>One final thing remains before we run the code &#8211; we first have to download the training data onto our instance. In the <a href="http://adventuresinmachinelearning.com/recurrent-neural-networks-lstm-tutorial-tensorflow/" target="_blank" rel="noopener">TensorFlow recurrent neural network tutorial</a> we used a text data-set from the following link: http://www.fit.vutbr.cz/~imikolov/rnnlm/simple-examples.tgz. You&#8217;ll need to download and extract this tarfile &#8211; to do this run the following:</p>
<blockquote><p>curl http://www.fit.vutbr.cz/~imikolov/rnnlm/simple-examples.tgz | tar xvz</p></blockquote>
<p>You can navigate around this extracted file / folder by using the Linux commands ls (to list the contents of the current path) and cd (for change directory). You need to find the path to simple-examples/data/ &#8211; this is where our training data files are located. Once you&#8217;ve done this, we can finally run the following command to start training the LSTM network created in the aforementioned tutorial:</p>
<blockquote><p>python lstm_tutorial.py 1 &#8211;data_path /home/ec2-user/data/simple-examples/data/</p></blockquote>
<p>Once you run the above command, the program will start and, after it prints out some text data it will begin to train the network (note the dash before &#8220;data_path&#8221; is actually a double dash: &#8220;&#8211;&#8220;). After every 50 iterations, you can observe the loss, the accuracy on the training set and the average time it took to execute each iteration. You&#8217;ll see something like this:</p>
<figure id="attachment_722" style="width: 663px" class="wp-caption aligncenter"><img class=" wp-image-722" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Example-output-with-step-timing-Amazon-AWS-GPU.png" alt="Amazon AWS TensorFlow - GPU training times" width="663" height="149" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Example-output-with-step-timing-Amazon-AWS-GPU.png 909w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Example-output-with-step-timing-Amazon-AWS-GPU-300x67.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/Example-output-with-step-timing-Amazon-AWS-GPU-768x172.png 768w" sizes="(max-width: 663px) 100vw, 663px" /><figcaption class="wp-caption-text">Example output with GPU training times</figcaption></figure>
<p>As you can observe, each iteration takes an average of 0.14 seconds to execute. I&#8217;ve also run this oj my own Intel i5 CPUs and the average iteration time is around 3 seconds &#8211; so we get a greater than 20 times increase in performance with a single Amazon AWS Nvidia GPU. Not bad!</p>
<p>While it&#8217;s training, let&#8217;s take a look at what our GPU doing &#8211; hit Ctrl-F3 or Ctrl-F4 and you&#8217;ll return to your gpustat watch print-out. It should look something like this:</p>
<figure id="attachment_724" style="width: 608px" class="wp-caption aligncenter"><img class=" wp-image-724" src="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/GPU_status_during_run.png" alt="Amazon AWS TensorFlow - GPU status" width="608" height="51" srcset="http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/GPU_status_during_run.png 926w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/GPU_status_during_run-300x25.png 300w, http://adventuresinmachinelearning.com/wp-content/uploads/2017/11/GPU_status_during_run-768x65.png 768w" sizes="(max-width: 608px) 100vw, 608px" /><figcaption class="wp-caption-text">GPU status while training the LSTM network</figcaption></figure>
<p>So here we can see that the GPU is running close to maximum capacity &#8211; 81%. Good to see</p>
<p>WARNING: Remember, you have to shut down your instance on your EC2 console on Amazon AWS when you are complete. It&#8217;s not enough to shut down your PuTTY session or similar &#8211; you have to go an shut down your instance on the AWS dashboard. If you don&#8217;t you&#8217;ll be getting charged per hour with the instance sitting there doing nothing!</p>
<p>I hope that&#8217;s been helpful and will let you get your own Amazon AWS deep learning instance up and running. Enjoy your faster model training!</p>
<hr />
<p><strong>Recommended online course: </strong>If you are more of a video course learner, checkout the following highly rated and inexpensive Udemy course, which covers deep learning concepts and how to deploy on Amazon AWS too: <a href="https://click.linksynergy.com/link?id=Jbc0N5ZkDzk&amp;offerid=323058.772462&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fdata-science-deep-learning-in-theano-tensorflow%2F" target="new">Modern Deep Learning in Python</a><img src="https://ad.linksynergy.com/fs-bin/show?id=Jbc0N5ZkDzk&amp;bids=323058.772462&amp;type=2&amp;subid=0" width="1" height="1" border="0" /></p>
<hr />
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="http://adventuresinmachinelearning.com/tensorflow-amazon-aws/">How to create a TensorFlow deep learning powerhouse on Amazon AWS</a> appeared first on <a rel="nofollow" href="http://adventuresinmachinelearning.com">Adventures in Machine Learning</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinmachinelearning.com/tensorflow-amazon-aws/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
